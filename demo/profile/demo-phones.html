<link rel="import" href="../../polymer/polymer-element.html">
<link rel="import" href="../../polymer/lib/elements/dom-repeat.html">
<script src="../../node_modules/object-hash/dist/object_hash.js"></script>
<dom-module id="demo-phones">
  <template>
    <style>
      :host {
        display: block;
      }
      .clickable {cursor: pointer;}
    </style>
    <p>
      <b>Tracking Flag: [[_getTrackingStatus(isEnable)]]</b>
      <button on-click="_enableTracking">Enable</button>
      <button on-click="_disableTracking">Disable</button>
    </p>
    <h4>Phone (<span>hasChanged: [[hasChanged]]</span>)</h4>
    <p>
      <select id="newPhoneType">
        <option value="work">Work</option>
        <option value="cell">Cell</option>
        <option value="home">Home</option>
      </select>
      <input value="{{newPhoneNumber::input}}"/>
      <button on-click="_addNumber">Add</button>
    </p>
    <template is="dom-repeat" items="[[phones]]">
      <p>[[item.type]]<input value="{{item.phone::input}}"/>
        <span class="clickable" on-click="updatePhone">[âœ”]</span>
        <span class="clickable" on-click="removePhone">[X]</span>
      </p>
    </template>
    <p>--------------------------</p>
    <template is="dom-repeat" items="[[phones]]">
      <p>[[item.type]]
        [[item.phone]]</p>
    </template>
  </template>

  <script>
    class DemoPhones extends FormTrackerMixin(Polymer.Element)  {
      static get is() { return 'demo-phones'; }
      static get properties() {
        return {
          phones: {
            type: Array,
            value: [],
            trackChange: true,
            isEqualFn: '_compareMyArray'
          },
          newPhoneNumber: String,
        };
      }
      _addNumber() {
        if(this.newPhoneNumber) {
          this.push('phones', {
            type: this.$.newPhoneType.value,
            phone: this.newPhoneNumber
          });
          this.newPhoneNumber = '';
        }
        /*setTimeout(()=> {
          console.clear();
          console.log('push');
          this.push('phones', {type: 'a',phone: 'aaa'}, {type: 'a1',phone: 'aaa1'});
          this.push('phones', {type: 'b',phone: 'bbb'});
          this.push('phones', {type: 'c',phone: 'ccc'});
          this.push('phones', {type: 'd',phone: 'ddd'});
          }, 1);

        setTimeout(()=> {
          console.log('pop');
          this.pop('phones');
        }, 10);

        setTimeout(()=> {
          console.log('unshift');
          this.unshift('phones',{type: 'e',phone: 'eee'});
          this.unshift('phones',
            {type: 'f',phone: 'fff'},{type: 'g',phone: 'ggg'});
        }, 20);

        setTimeout(()=> {
          console.log('shift');
          this.shift('phones');
        }, 30);

        setTimeout(()=> {
          console.log('splice');
          this.splice('phones', 1, 1);
          this.splice('phones', 1, 0, {type: 'h',phone: 'hhh'}, {type: 'i',phone: 'iii'});
        }, 40);

        setTimeout(()=> {
          console.log('set');
          this.set('phones.1', {type: 'ah',phone: 'ahhh'});
        }, 40);*/
      }
      updatePhone(e) {
        const idx = e.model.index;
        const {type, phone} = e.model.item;
        //this.splice('phones', e.model.index, 1, {type,phone});
        this.set(`phones.${idx}`, {type,phone});
      }
      removePhone(e) {
        this.splice('phones', e.model.index, 1);
      }
      _compareMyArray(org, cur, path) {
        return objectHash(org) === objectHash(cur);
      }
    }

    window.customElements.define(DemoPhones.is, DemoPhones);
  </script>
</dom-module>
